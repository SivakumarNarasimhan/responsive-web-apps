// ==========================================
// Copyright 2013 Twitter, Inc
// Licensed under The MIT License
// http://opensource.org/licenses/MIT
// ==========================================

//implementation lifted from underscore.js (c) 2009-2012 Jeremy Ashkenas

define("flight/lib/utils",[],function(){var e=[],t=100,n={isDomObj:function(e){return!!e.nodeType||e===window},toArray:function(t,n){return e.slice.call(t,n)},merge:function(){var e=arguments.length,t=0,n=new Array(e+1);for(;t<e;t++)n[t+1]=arguments[t];return e===0?{}:(n[0]={},n[n.length-1]===!0&&(n.pop(),n.unshift(!0)),$.extend.apply(undefined,n))},push:function(e,t,n){return e&&Object.keys(t||{}).forEach(function(r){if(e[r]&&n)throw Error("utils.push attempted to overwrite '"+r+"' while running in protected mode");typeof e[r]=="object"&&typeof t[r]=="object"?this.push(e[r],t[r]):e[r]=t[r]},this),e},isEnumerable:function(e,t){return Object.keys(e).indexOf(t)>-1},compose:function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},uniqueArray:function(e){var t={},n=[];for(var r=0,i=e.length;r<i;++r){if(t.hasOwnProperty(e[r]))continue;n.push(e[r]),t[e[r]]=1}return n},debounce:function(e,n,r){typeof n!="number"&&(n=t);var i,s;return function(){var t=this,o=arguments,u=function(){i=null,r||(s=e.apply(t,o))},a=r&&!i;return clearTimeout(i),i=setTimeout(u,n),a&&(s=e.apply(t,o)),s}},throttle:function(e,n){typeof n!="number"&&(n=t);var r,i,s,o,u,a,f=this.debounce(function(){u=o=!1},n);return function(){r=this,i=arguments;var t=function(){s=null,u&&(a=e.apply(r,i)),f()};return s||(s=setTimeout(t,n)),o?u=!0:(o=!0,a=e.apply(r,i)),f(),a}},countThen:function(e,t){return function(){if(!--e)return t.apply(this,arguments)}},delegate:function(e){return function(t,n){var r=$(t.target),i;Object.keys(e).forEach(function(s){if((i=r.closest(s)).length)return n=n||{},n.el=i[0],e[s].apply(this,[t,n])},this)}}};return n}),define("flight/lib/registry",["./utils"],function(e){function t(e,t){var n,r,i,s=t.length;return typeof t[s-1]=="function"&&(s-=1,i=t[s]),typeof t[s-1]=="object"&&(s-=1),s==2?(n=t[0],r=t[1]):(n=e.node,r=t[0]),{element:n,type:r,callback:i}}function n(e,t){return e.element==t.element&&e.type==t.type&&(t.callback==null||e.callback==t.callback)}function r(){function r(t){this.component=t,this.attachedTo=[],this.instances={},this.addInstance=function(e){var t=new i(e);return this.instances[e.identity]=t,this.attachedTo.push(e.node),t},this.removeInstance=function(t){delete this.instances[t.identity];var n=this.attachedTo.indexOf(t.node);n>-1&&this.attachedTo.splice(n,1),Object.keys(this.instances).length||e.removeComponentInfo(this)},this.isAttachedTo=function(e){return this.attachedTo.indexOf(e)>-1}}function i(t){this.instance=t,this.events=[],this.addBind=function(t){this.events.push(t),e.events.push(t)},this.removeBind=function(e){for(var t=0,r;r=this.events[t];t++)n(r,e)&&this.events.splice(t,1)}}var e=this;(this.reset=function(){this.components=[],this.allInstances={},this.events=[]}).call(this),this.addInstance=function(e){var t=this.findComponentInfo(e);t||(t=new r(e.constructor),this.components.push(t));var n=t.addInstance(e);return this.allInstances[e.identity]=n,t},this.removeInstance=function(e){var t,n=this.findInstanceInfo(e),r=this.findComponentInfo(e);r&&r.removeInstance(e),delete this.allInstances[e.identity]},this.removeComponentInfo=function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},this.findComponentInfo=function(e){var t=e.attachTo?e:e.constructor;for(var n=0,r;r=this.components[n];n++)if(r.component===t)return r;return null},this.findInstanceInfo=function(e){return this.allInstances[e.identity]||null},this.findInstanceInfoByNode=function(e){var t=[];return Object.keys(this.allInstances).forEach(function(n){var r=this.allInstances[n];r.instance.node===e&&t.push(r)},this),t},this.on=function(n){var r=e.findInstanceInfo(this),i,s=arguments.length,o=1,u=new Array(s-1);for(;o<s;o++)u[o-1]=arguments[o];if(r){i=n.apply(null,u),i&&(u[u.length-1]=i);var a=t(this,u);r.addBind(a)}},this.off=function(r,i,s){var o=t(this,arguments),u=e.findInstanceInfo(this);u&&u.removeBind(o);for(var a=0,f;f=e.events[a];a++)n(f,o)&&e.events.splice(a,1)},e.trigger=new Function,this.teardown=function(){e.removeInstance(this)},this.withRegistration=function(){this.before("initialize",function(){e.addInstance(this)}),this.around("on",e.on),this.after("off",e.off),window.DEBUG&&DEBUG.enabled&&this.after("trigger",e.trigger),this.after("teardown",{obj:e,fnName:"teardown"})}}return new r}),define("flight/tools/debug/debug",["../../lib/registry","../../lib/utils"],function(e,t){function r(e,t,n){var n=n||{},i=n.obj||window,o=n.path||(i==window?"window":""),u=Object.keys(i);u.forEach(function(n){(s[e]||e)(t,i,n)&&console.log([o,".",n].join(""),"->",["(",typeof i[n],")"].join(""),i[n]),Object.prototype.toString.call(i[n])=="[object Object]"&&i[n]!=i&&o.split(".").indexOf(n)==-1&&r(e,t,{obj:i[n],path:[o,n].join(".")})})}function i(e,t,n,i){!t||typeof n==t?r(e,n,i):console.error([n,"must be",t].join(" "))}function o(e,t){i("name","string",e,t)}function u(e,t){i("nameContains","string",e,t)}function a(e,t){i("type","function",e,t)}function f(e,t){i("value",null,e,t)}function l(e,t){i("valueCoerced",null,e,t)}function c(e,t){r(e,null,t)}function v(){var e=[].slice.call(arguments);n.eventNames.length||(n.eventNames=h),n.actions=e.length?e:h,b()}function m(){var e=[].slice.call(arguments);n.actions.length||(n.actions=h),n.eventNames=e.length?e:h,b()}function g(){n.actions=[],n.eventNames=[],b()}function y(){n.actions=h,n.eventNames=h,b()}function b(){window.localStorage&&(localStorage.setItem("logFilter_eventNames",n.eventNames),localStorage.setItem("logFilter_actions",n.actions))}function w(){var e={eventNames:window.localStorage&&localStorage.getItem("logFilter_eventNames")||p,actions:window.localStorage&&localStorage.getItem("logFilter_actions")||d};return Object.keys(e).forEach(function(t){var n=e[t];typeof n=="string"&&n!==h&&(e[t]=n.split(","))}),e}var n,s={name:function(e,t,n){return e==n},nameContains:function(e,t,n){return n.indexOf(e)>-1},type:function(e,t,n){return t[n]instanceof e},value:function(e,t,n){return t[n]===e},valueCoerced:function(e,t,n){return t[n]==e}},h="all",p=[],d=[],n=w();return{enable:function(e){this.enabled=!!e,e&&window.console&&(console.info("Booting in DEBUG mode"),console.info("You can configure event logging with DEBUG.events.logAll()/logNone()/logByName()/logByAction()")),window.DEBUG=this},find:{byName:o,byNameContains:u,byType:a,byValue:f,byValueCoerced:l,custom:c},events:{logFilter:n,logByAction:v,logByName:m,logAll:y,logNone:g}}}),define("flight/lib/compose",["./utils","../tools/debug/debug"],function(e,t){function s(e,t){if(!n)return;var i=Object.create(null);Object.keys(e).forEach(function(n){if(r.indexOf(n)<0){var s=Object.getOwnPropertyDescriptor(e,n);s.writable=t,i[n]=s}}),Object.defineProperties(e,i)}function o(e,t,r){var i;if(!n||!e.hasOwnProperty(t)){r.call(e);return}i=Object.getOwnPropertyDescriptor(e,t).writable,Object.defineProperty(e,t,{writable:!0}),r.call(e),Object.defineProperty(e,t,{writable:i})}function u(e,t){e.mixedIn=e.hasOwnProperty("mixedIn")?e.mixedIn:[],t.forEach(function(t){e.mixedIn.indexOf(t)==-1&&(s(e,!1),t.call(e),e.mixedIn.push(t))}),s(e,!0)}var n=t.enabled&&!e.isEnumerable(Object,"getOwnPropertyDescriptor"),r=["mixedIn"];if(n)try{Object.getOwnPropertyDescriptor(Object,"keys")}catch(i){n=!1}return{mixin:u,unlockProperty:o}}),define("flight/lib/advice",["./utils","./compose"],function(e,t){var n={around:function(e,t){return function(){var r=0,i=arguments.length,s=new Array(i+1);s[0]=e.bind(this);for(;r<i;r++)s[r+1]=arguments[r];return t.apply(this,s)}},before:function(e,t){var n=typeof t=="function"?t:t.obj[t.fnName];return function(){return n.apply(this,arguments),e.apply(this,arguments)}},after:function(e,t){var n=typeof t=="function"?t:t.obj[t.fnName];return function(){var r=(e.unbound||e).apply(this,arguments);return n.apply(this,arguments),r}},withAdvice:function(){["before","after","around"].forEach(function(e){this[e]=function(r,i){t.unlockProperty(this,r,function(){return typeof this[r]=="function"?this[r]=n[e](this[r],i):this[r]=i})}},this)}};return n}),define("flight/lib/logger",["./compose","./utils"],function(e,t){function r(e){var t=e.tagName?e.tagName.toLowerCase():e.toString(),n=e.className?"."+e.className:"",r=t+n;return e.tagName?["'","'"].join(r):r}function i(e,t,i){var s,o,u,a,f,l,c,h;typeof i[i.length-1]=="function"&&(u=i.pop(),u=u.unbound||u),typeof i[i.length-1]=="object"&&i.pop(),i.length==2?(o=i[0],s=i[1]):(o=t.$node[0],s=i[0]),window.DEBUG&&window.DEBUG.enabled&&(f=DEBUG.events.logFilter,c=f.actions=="all"||f.actions.indexOf(e)>-1,l=function(e){return e.test?e:new RegExp("^"+e.replace(/\*/g,".*")+"$")},h=f.eventNames=="all"||f.eventNames.some(function(e){return l(e).test(s)}),c&&h&&console.info(n[e],e,"["+s+"]",r(o),t.constructor.describe.split(" ").slice(0,3).join(" ")))}function s(){this.before("trigger",function(){i("trigger",this,t.toArray(arguments))}),this.before("on",function(){i("on",this,t.toArray(arguments))}),this.before("off",function(e){i("off",this,t.toArray(arguments))})}var n={on:"<-",trigger:"->",off:"x "};return s}),define("flight/lib/component",["./advice","./utils","./compose","./registry","./logger","../tools/debug/debug"],function(e,t,n,r,i,s){function a(e){e.events.slice().forEach(function(e){var t=[e.type];e.element&&t.unshift(e.element),typeof e.callback=="function"&&t.push(e.callback),this.off.apply(this,t)},e.instance)}function f(){a(r.findInstanceInfo(this))}function l(){var e=r.findComponentInfo(this);e&&Object.keys(e.instances).forEach(function(t){var n=e.instances[t];n.instance.teardown()})}function c(e,t){try{window.postMessage(t,"*")}catch(n){throw console.log("unserializable data for event",e,":",t),new Error(["The event",e,"on component",this.toString(),"was triggered with non-serializable data"].join(" "))}}function h(){this.trigger=function(){var e,t,n,r,i,o=arguments.length-1,u=arguments[o];return typeof u!="string"&&(!u||!u.defaultBehavior)&&(o--,n=u),o==1?(e=$(arguments[0]),r=arguments[1]):(e=this.$node,r=arguments[0]),r.defaultBehavior&&(i=r.defaultBehavior,r=$.Event(r.type)),t=r.type||r,s.enabled&&window.postMessage&&c.call(this,t,n),typeof this.attr.eventData=="object"&&(n=$.extend(!0,{},this.attr.eventData,n)),e.trigger(r||t,n),i&&!r.isDefaultPrevented()&&(this[i]||i).call(this),e},this.on=function(){var e,n,r,i,s=arguments.length-1,o=arguments[s];typeof o=="object"?i=t.delegate(this.resolveDelegateRules(o)):i=o,s==2?(e=$(arguments[0]),n=arguments[1]):(e=this.$node,n=arguments[0]);if(typeof i!="function"&&typeof i!="object")throw new Error("Unable to bind to '"+n+"' because the given callback is not a function or an object");return r=i.bind(this),r.target=i,i.guid&&(r.guid=i.guid),e.on(n,r),i.guid=r.guid,r},this.off=function(){var e,t,n,r=arguments.length-1;return typeof arguments[r]=="function"&&(n=arguments[r],r-=1),r==1?(e=$(arguments[0]),t=arguments[1]):(e=this.$node,t=arguments[0]),e.off(t,n)},this.resolveDelegateRules=function(e){var t={};return Object.keys(e).forEach(function(n){if(!n in this.attr)throw new Error('Component "'+this.toString()+'" wants to listen on "'+n+'" but no such attribute was defined.');t[this.attr[n]]=e[n]},this),t},this.defaultAttrs=function(e){t.push(this.defaults,e,!0)||(this.defaults=e)},this.select=function(e){return this.$node.find(this.attr[e])},this.initialize=$.noop,this.teardown=f}function p(e){var n=arguments.length,i=new Array(n-1);for(var s=1;s<n;s++)i[s-1]=arguments[s];if(!e)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");var o=t.merge.apply(t,i);$(e).each(function(e,t){var n=t.jQuery?t[0]:t,i=r.findComponentInfo(this);if(i&&i.isAttachedTo(n))return;new this(t,o)}.bind(this))}function d(){function c(e,t){t=t||{},this.identity=u++;if(!e)throw new Error("Component needs a node");e.jquery?(this.node=e[0],this.$node=e):(this.node=e,this.$node=$(e)),this.toString=c.toString,s.enabled&&(this.describe=this.toString());var n=Object.create(t);for(var r in this.defaults)t.hasOwnProperty(r)||(n[r]=this.defaults[r]);this.attr=n,Object.keys(this.defaults||{}).forEach(function(e){if(this.defaults[e]===null&&this.attr[e]===null)throw new Error('Required attribute "'+e+'" not specified in attachTo for component "'+this.toString()+'".')},this),this.initialize.call(this,t)}var t=arguments.length,a=new Array(t+3);for(var f=0;f<t;f++)a[f]=arguments[f];return c.toString=function(){var e=a.map(function(e){if(e.name==null){var t=e.toString().match(o);return t&&t[1]?t[1]:""}return e.name!="withBaseComponent"?e.name:""}).filter(Boolean).join(", ");return e},s.enabled&&(c.describe=c.toString()),c.attachTo=p,c.teardownAll=l,s.enabled&&a.unshift(i),a.unshift(h,e.withAdvice,r.withRegistration),n.mixin(c.prototype,a),c}var o=/function (.*?)\s?\(/,u=0;return d.teardownAll=function(){r.components.slice().forEach(function(e){e.component.teardownAll()}),r.reset()},d}),define("view/flightView/main",["flight/lib/component"],function(e){function n(){this.render=function(){this.$node.html(t)},this.after("initialize",function(){this.render()})}var t='<p class="module">Rendered the default Flight view (<code>view/flightView</code>).</p>';return e(n)}),define("view/flightView/spec",["view/flightView/main"],{flightView:{create:{module:"view/flightView/main",args:{$ref:"viewNode"}}},plugins:[{module:"wire/debug",trace:!0}]});